.header
  %a{:href => '/'} Back to field selection
  %br
  %a{:href => "#{request.path_info}.csv?#{request.query_string}"} Download CSV

%table#main.display
  %thead
    %tr
      - sort_by_ref(@data.keys, source_keys).each do |source|
        - sort_fields(@data[source].keys, source).each do |column|
          %th{:title => @data[source][column][:title]}
            = @data[source][column][:header] ? @data[source][column][:header] : column.to_s.titleize
  %tbody
    - @legislators.each do |legislator|
      %tr
        - sort_by_ref(@data.keys, source_keys).each do |source|
          - sort_fields(@data[source].keys, source).each do |column|
            %td= @data[source][column][legislator.bioguide_id]

%script{:type => 'text/javascript'}
  :plain
    $(document).ready(function() {
      $('#main').dataTable({
        bProcessing: true,
        bPaginate: false,
        aaSorting: [[1, 'asc'], [2, 'asc']]
      });
    });